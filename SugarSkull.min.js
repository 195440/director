var APP=(typeof APP!="undefined")?APP:{overrides:{},override:function(ns,first){overrides[ns]=first},router:{getRoute:function(hash){var namedRoutes=this.namedRoutes;var finishedRoutes=this.finishedRoutes;hash=hash.slice(1,hash.length).split("/");for(name in namedRoutes){var route=namedRoutes[name].route;var match=false,finsihed=false;for(var i=0;i<finishedRoutes.length;i++){if(name===finishedRoutes[i]){finsihed=true;break}}if(!finsihed){for(var i=0;i<route.length;i++){if(route[i]===hash[i]||route[i]==="*"){match=true}else{match=false;break}}if(match&&route.length===hash.length){if(namedRoutes[name].once&&namedRoutes[name].once===true){this.finishedRoutes.push(name)}namedRoutes[name].name=name;return namedRoutes[name]}}}},finishedRoutes:[],namedRoutes:{},exitMethods:[],leaveAllRoutes:[],onAllRoutes:[]},exec:function(scope,params){var self=this,strNS=params.ns,ns={},sectors=strNS.split('.'),methods,isArray=(function(){return Array.isArray||function(obj){return!!(obj&&obj.concat&&obj.unshift&&!obj.callee)}})();this.router.namedRoutes=params.routes;var i=0,len=sectors.length;for(i;i<sectors.length;i++){var sector=sectors[i];if(i==0&&!window[sector]){window[sector]={};ns=window[sector]}else{ns=ns[sector]=(ns[sector]?ns[sector]:{})}}delete this.Main;eval(params.ns+" = this;");methods=(typeof APP.overrides[ns]=="undefined")?params.first:APP.overrides[ns];function fireMethods(methods,routeName){if(isArray(methods)){for(var i=0;i<methods.length;i++){if(isArray(methods[i])){var params=methods[i].slice(1,methods[i].length);if(routeName){params.push(routeName)}scope[methods[i][0]].call(scope,params)}else{scope[methods[i]].call(scope,routeName)}}}else{scope[methods].call(scope,routeName)}}fireMethods(methods);this.hashListener.Init(function(){var r=self.router;var route=r.getRoute(self.hashListener.hash);var routeName=route.name;fireMethods(r.leaveAllRoutes,routeName);fireMethods(r.exitMethods,routeName);(typeof route.onAllRoutes!="undefined")?fireMethods(route.onAllRoutes,routeName):route.before={};if(route){(typeof route.on!="undefined")?fireMethods(route.on,routeName):route.on;(typeof route.leave!="undefined")?r.exitMethods=route.leave:{}}})},hashListener:{ie:/MSIE/.test(navigator.userAgent),ieSupportBack:true,hash:document.location.hash,check:function(){var h=document.location.hash;if(h!=this.hash){this.hash=h;this.onHashChanged()}},Init:function(fn){this.onHashChanged=fn;if(this.ie&&this.ieSupportBack){var frame=document.createElement("iframe");frame.id="state-frame";frame.style.display="none";document.body.appendChild(frame);this.writeFrame("")}var self=this;if("onpropertychange"in document&&"attachEvent"in document){document.attachEvent("onpropertychange",function(){if(event.propertyName=="location"){self.check()}})}window.setInterval(function(){self.check()},50)},setHash:function(s){if(this.ie&&this.ieSupportBack){this.writeFrame(s)}document.location.hash=s},getHash:function(){return document.location.hash},writeFrame:function(s){var f=document.getElementById("state-frame");var d=f.contentDocument||f.contentWindow.document;d.open();d.write("<script>window._hash = '"+s+"'; window.onload = parent.hashListener.syncHash;<\/script>");d.close()},syncHash:function(){var s=this._hash;if(s!=document.location.hash){document.location.hash=s}},onHashChanged:function(){}}};