;(function(){this.Router=function(k,h){if(!(this instanceof Router)){return new Router(k,h)}var o=this,f=false,d={},n;this.retired=[];this.routes=k;function g(){var p=document.location.hash;if(p[1]=="/"){p=p.substr(1,p.length)}return p.slice(1,p.length).split("/")}function j(r,q,p){if(!r){return false}if(Object.prototype.toString.call(r)!=="[object Array]"){r=[r]}for(var t=0;t<r.length;t++){if(!o.retired[r[t]]){if(h&&typeof r[t]=="string"){h[r[t]].apply(h,p)}else{if(typeof r[t]!="string"){r[t].apply(null,p)}else{throw new Error("exec: method not found on route '"+q+"'.")}}}}}function i(p,t,q){var u=p[t];if(typeof u==="string"||!!(u&&u.constructor&&u.call&&u.apply)){j(u,t,q)}if(u.once===true){o.retired[t]=true}else{if(u.once){j(u.once,t,q);delete u.once}}if(u.on){j(u.on,t,q)}n=u.onleave||null}function m(p,q){v=document.location.hash;v=v.slice(1);e(p,q,v,0)}function e(z,x,u,p){if(x[0]!=="/"){return}var t=p===0?"^\\/":"",q=new RegExp(t+x.slice(1)+"(.*)?").exec(u);if(q&&q.length>0&&!o.retired[x]){if(z[x].state){o.state=z[x].state}var y=q.slice(1),r=y.pop();i(z,x,y);if(typeof r==="string"&&r.length>0){for(var w in z[x]){if(z[x].hasOwnProperty(w)){if(w.indexOf("/")===0){e(z[x],w,r,++p)}}}}}}function l(r){var p=o.routes;if(r&&r.state){d=r.state}if(p.before){j(p.before.on||p.before)}if(p.leave&&!f){j(p.leave.on||p.leave)}if(p.once){j(p.once);delete p.once}if(o.leave){j(o.leave);o.onleave=null}for(var q in p){if(p.hasOwnProperty(q)){m(p,q)}}if(p.after){j(p.after.on||p.after)}}f=false;this.init=function(){b.init(l);l();return this};this.getState=function(){return o.state};this.getRetired=function(){return o.retired};this.getRoute=function(p){if(typeof p=="number"){return g()[p]}else{if(typeof p=="string"){var q=g();return q.indexOf(p)}else{return g()}}};this.setRoute=function(r,p,t){var q=g();if(typeof r==="number"&&typeof p==="string"){q[r]=p}else{if(typeof t==="string"){q.splice(r,p,s)}else{q=[r]}}b.setHash(q.join("/"));return q};return this};var a="0.2.7",c="compatibility",b={hash:document.location.hash,check:function(){var d=document.location.hash;if(d!=this.hash){this.hash=d;this.onHashChanged()}},fire:function(){if(c=="compatibility"){window.onhashchange()}else{this.onHashChanged()}},init:function(e){var d=this;if("onhashchange" in window&&(document.documentMode===undefined||document.documentMode>7)){window.onhashchange=e;c="compatibility"}else{var f=document.createElement("iframe");f.id="state-frame";f.style.display="none";document.body.appendChild(f);this.writeFrame("");if("onpropertychange" in document&&"attachEvent" in document){document.attachEvent("onpropertychange",function(){if(event.propertyName=="location"){d.check()}})}this.onHashChanged=e;window.setInterval(function(){d.check()},50);c="legacy"}return c},setHash:function(d){if(c=="legacy"){this.writeFrame(d)}document.location.hash=(d[0]==="/")?d:"/"+d;return this},writeFrame:function(e){var g=document.getElementById("state-frame");var h=g.contentDocument||g.contentWindow.document;h.open();h.write("<script>window._hash = '"+e+"'; window.onload = parent.listener.syncHash;<\/script>");h.close()},syncHash:function(){var d=this._hash;if(d!=document.location.hash){document.location.hash=d}return this},onHashChanged:function(){}}}).call(window);