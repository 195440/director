#!/usr/bin/env node

var Codesurgeon = require('codesurgeon').Codesurgeon;
var surgeon = new Codesurgeon;

var path    = require('path');

var root    = path.join(__dirname, '..');
var lib     = path.join(root, 'lib', 'sugarskull');

//
// Distill and package the browser version.
//

surgeon
  .configure({ 
    package: root + '/package.json',
    owner: 'Nodejitsu, Inc.'
  })
  .read(
    path.join(lib, 'router.js'),
    path.join(lib, 'browser.js')
  )
  .extract(
    'dloc',
    '_every',
    'listener',
    'paramifyString',
    'regifyString',
    'dispatch',
    'Router',
    'Router.prototype.configure',
    'Router.prototype.param',
    'Router.prototype.on',
    'Router.prototype.dispatch',
    'Router.prototype.invoke',
    'Router.prototype.traverse',
    'Router.prototype.insert',
    'Router.prototype.extend',
    'Router.prototype.mount',
    'Router.prototype.init',
    'Router.prototype.explode',
    'Router.prototype.setRoute',
    'Router.prototype.getState',
    'Router.prototype.getRoute',
    'Router.prototype.destroy',
    'Router.prototype.recurse'
  )
  .wrap()
  .write(root + '/build/sugarskull.js')
  .uglify()
  .write(root + '/build/sugarskull.min.js')
;
